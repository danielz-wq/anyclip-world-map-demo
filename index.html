<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AnyClip World Map Demo üåç</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    :root {
      --bg:#0b0f14; --panel:#121821; --muted:#9fb0c2; --text:#e6edf3; --accent:#49a0ff;
      --chip:#192231; --chipOn:#1f2b3d; --shadow:0 10px 30px rgba(0,0,0,.35);
    }
 html, body {
  margin: 0;
  height: 100%;
  background-color: #050712;
  background-image:
    linear-gradient(rgba(66, 78, 110, 0.12) 1px, transparent 1px),
    linear-gradient(90deg, rgba(66, 78, 110, 0.12) 1px, transparent 1px),
    radial-gradient(circle at 15% 10%, rgba(80, 180, 255, 0.25) 0, transparent 55%),
    radial-gradient(circle at 80% 90%, rgba(180, 80, 255, 0.18) 0, transparent 55%);
  background-size:
    40px 40px,
    40px 40px,
    100% 100%,
    100% 100%;
  color: var(--text);
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
}

/* Map card */
#map {
  height: 86vh;
  width: 80vw;
  margin: 26px auto;
  border-radius: 22px;
  overflow: hidden;
  background: #050910;
  box-shadow:
    0 22px 55px rgba(0,0,0,0.7),
    0 0 0 1px rgba(120, 180, 255, 0.18);
}



    /* Floating filter panel */
    .filters {
      position: fixed;
      top: 16px; left: 16px;
      width: 320px; max-width: calc(100% - 32px);
      background: var(--panel);
      border: 1px solid #243244;
      border-radius: 14px;
      box-shadow: var(--shadow);
      padding: 14px;
      z-index: 1000;
      backdrop-filter: blur(4px);
    }
    .filters h2 {
      margin: 0 0 8px; font-size: 16px; letter-spacing:.2px;
    }
    .row { display: grid; gap: 8px; margin: 10px 0; }
    .group { border-top: 1px solid #223246; padding-top: 10px; }
    .label {
      font-size: 12px; color: var(--muted);
      text-transform: uppercase; letter-spacing: .6px;
    }
    .chips { display:flex; flex-wrap: wrap; gap: 6px; margin-top: 6px; }
    .chip {
      background: var(--chip); border: 1px solid #263243; color: var(--text);
      padding: 6px 10px; border-radius: 999px;
      font-size: 12px; cursor: pointer; user-select: none;
    }
    .chip.active {
      background: var(--chipOn); border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(73,160,255,.35) inset;
    }
    .controls { display:flex; gap:8px; align-items:center; }
    .search {
      width:100%; background: #0e141c; border: 1px solid #223246; border-radius: 10px;
      color: var(--text); padding: 8px 10px; outline: none; font-size: 13px;
    }
    .btn {
      background: var(--accent); color: #061320; border: none; border-radius: 10px;
      padding: 8px 10px; font-weight: 600; cursor: pointer; font-size: 12px;
    }
    .meta {
      display:flex; justify-content: space-between; align-items:center;
      font-size:12px; color: var(--muted); margin-top: 6px;
    }
    .toggle {
      position:absolute; top: -12px; right: -12px;
      background:#0e141c; border:1px solid #223246; color:var(--text);
      width: 32px; height:32px; border-radius: 999px;
      cursor:pointer; display:grid; place-items:center; box-shadow:var(--shadow);
    }
    .collapsed { height: 46px; overflow: hidden; padding-bottom: 8px; }

    .leaflet-popup-content-wrapper, .leaflet-popup-tip {
      background:#0e141c; color:var(--text); border:1px solid #2a384b;
    }
    a.link { color: var(--accent); text-decoration: none; }

    /* Player panel */
    .player-panel {
      position: fixed;
      right: 16px; bottom: 16px;
      width: 380px; max-width: calc(100% - 32px);
      background: var(--panel);
      border: 1px solid #243244;
      border-radius: 14px;
      box-shadow: var(--shadow);
      z-index: 999;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .player-header {
      display:flex; justify-content:space-between; align-items:center;
      padding: 8px 10px 6px;
      border-bottom: 1px solid #223246;
      background:#0f151f;
      cursor: move;
    }
    .player-title {
      font-size: 13px; font-weight:600;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .player-meta {
      font-size: 11px; color: var(--muted);
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .player-close {
      background: transparent; border:none; color:var(--muted);
      font-size: 18px; cursor:pointer; padding: 0 4px;
    }
    .player-body {
      padding: 8px;
      background:#05080e;
    }
    .player-placeholder {
      font-size: 12px; color: var(--muted);
      min-height: 200px;
      display:flex; align-items:center; justify-content:center;
      text-align:center; padding: 10px;
      border: 1px dashed #223246; border-radius: 10px;
    }
    .player-frame-wrap {
      display:none;
      position: relative;
      padding-top: 56.25%; /* 16:9 */
      border-radius: 10px;
      overflow: hidden;
      border: 1px solid #223246;
    }
    .player-frame-wrap iframe {
      position:absolute; top:0; left:0;
      width:100%; height:100%;
      border:0;
    }

    @media (max-width: 768px) {
      .filters { width:auto; right:16px; }
      .player-panel { left:16px; right:16px; width:auto; }
    }
	
	/* --- Live event marker styles --- */
	.marker-live-past .dot-past {
	  width: 18px;
	  height: 18px;
	  background: #3da5ff; /* blue */
	  border-radius: 50%;
	  border: 2px solid white;
	}

	.marker-live-current .dot-current {
	  width: 18px;
	  height: 18px;
	  background: #3cff76; /* green */
	  border-radius: 50%;
	  border: 2px solid white;
	  box-shadow: 0 0 0 rgba(0,255,0,0.4);
	  animation: pulse 1.5s infinite;
	}

	@keyframes pulse {
	  0% { box-shadow: 0 0 0 0 rgba(0,255,0,0.5); }
	  70% { box-shadow: 0 0 0 12px rgba(0,255,0,0); }
	  100% { box-shadow: 0 0 0 0 rgba(0,255,0,0); }
	}

	.marker-live-future .dot-future {
	  width: 18px;
	  height: 18px;
	  background: transparent;
	  border-radius: 50%;
	  border: 2px solid #ffffff; /* white outline */
	  opacity: 0.7;
	}

  </style>
</head>
<body>
  <div id="map"></div>

  <!-- Floating Filters -->
  <div class="filters" id="filters">
    <button class="toggle" id="toggle" title="Collapse/Expand">‚ñæ</button>
	 <!-- NEW: Product title -->
    <div style="margin-bottom:12px;">
      <div style="
        font-size:22px;
        font-weight:700;
        color:var(--text);
        letter-spacing:0.4px;
      ">
        AnyClip World Video Pulse üåç
      </div>
      <div style="
        font-size:12px;
        color:var(--muted);
        margin-top:4px;
        line-height:1.35;
      ">
        A real-time global view of trending videos and live events.<br/>
        Filter by region, topic, publisher, and AnyClip Live Events.
      </div>
    </div>
    <h2>Filters</h2>

    <div class="row">
      <div class="controls">
        <input id="search" class="search" placeholder="Search title‚Ä¶ (e.g. Tokyo, marathon, BBC)" />
        <button class="btn" id="reset">Reset</button>
      </div>
    </div>

    <div class="row group">
      <div class="label">Publisher</div>
      <div class="chips" id="sources">
        <div class="chip" data-value="BBC">BBC</div>
        <div class="chip" data-value="CNN">CNN</div>
        <div class="chip" data-value="YNET">YNET</div>
        <div class="chip" data-value="REUTERS">Reuters</div>
      </div>
    </div>

    <div class="row group">
      <div class="label">Topic</div>
      <div class="chips" id="topics">
        <div class="chip" data-value="News">News</div>
        <div class="chip" data-value="Sports">Sports</div>
        <div class="chip" data-value="Tech">Tech</div>
        <div class="chip" data-value="Food">Food</div>
        <div class="chip" data-value="Culture">Culture</div>
      </div>
    </div>

    <div class="row group">
      <div class="label">Region</div>
      <div class="chips" id="regions">
        <div class="chip" data-value="Americas">Americas</div>
        <div class="chip" data-value="Europe">Europe</div>
        <div class="chip" data-value="Asia">Asia</div>
        <div class="chip" data-value="Middle East">Middle East</div>
      </div>
    </div>
	<div class="row group">
	  <div class="label">AnyClip Live Events</div>
	  <div class="chips" id="liveEvents">
		<div class="chip" data-value="past">Past</div>
		<div class="chip" data-value="current">Current</div>
		<div class="chip" data-value="future">Future</div>
	  </div>
	</div>

    <div class="meta">
      <div id="count">0 results</div>
      <div id="activeFilters">No filters</div>
    </div>
  </div>

  <!-- Player panel -->
  <div class="player-panel" id="playerPanel">
    <div class="player-header">
      <div>
        <div id="playerTitle" class="player-title">Select a point on the map</div>
        <div id="playerMeta" class="player-meta">No video playing</div>
      </div>
      <button id="playerClose" class="player-close" title="Close">√ó</button>
    </div>
    <div class="player-body">
      <div id="playerPlaceholder" class="player-placeholder">
        Click a marker on the map to start playing a video from that region.
      </div>
      <div class="player-frame-wrap" id="playerFrameWrap">
        <iframe
          id="ytFrame"
          src=""
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
          loading="lazy"
        ></iframe>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
   // --- Map init ---
		const worldBounds = L.latLngBounds(
		  L.latLng(-85, -180),
		  L.latLng(85, 180)
		);
		
		const map = L.map('map', {
		  zoomControl: true,
		  maxBounds: worldBounds,
		  maxBoundsViscosity: 1.0  // "sticky" at the edges
		}).setView([20, 0], 2);
		
		L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
		  maxZoom: 7,
		  noWrap: true,                       // <‚Äì prevents duplicate worlds
		  bounds: worldBounds,
		  attribution: '¬© OpenStreetMap contributors'
		}).addTo(map);
		
		// --- Custom marker icons for Live Events ---
		const liveIcons = {
		  past: L.divIcon({
			className: "marker-live-past",
			iconSize: [22, 22],
			html: `<div class="dot-past"></div>`
		  }),
		  current: L.divIcon({
			className: "marker-live-current",
			iconSize: [22, 22],
			html: `<div class="dot-current"></div>`
		  }),
		  future: L.divIcon({
			className: "marker-live-future",
			iconSize: [22, 22],
			html: `<div class="dot-future"></div>`
		  })
		};


    // --- Demo data (with YouTube videoId) ---
    const demoVideos = [
      // Americas
      {
        id:'1',
        title:'NYC Street Food Rising',
        source:'YNET',
        topic:'Food',
        country:'US',
        region:'Americas',
        lat:40.7128, lng:-74.0060,
        videoId:'eB0EycZScNY'
      },
      {
        id:'2',
        title:'Silicon Valley AI Summit Highlights',
        source:'CNN',
        topic:'Tech',
        country:'US',
        region:'Americas',
        lat:37.3875, lng:-122.0575,
        videoId:'VDzIJ4yg1b4'
      },
      {
        id:'3',
        title:'Brazil Football Fever',
        source:'REUTERS',
        topic:'Sports',
        country:'BR',
        region:'Americas',
        lat:-23.5505, lng:-46.6333,
        videoId:'0C0PjkMyEss'
      },

      // Europe
      {
        id:'4',
        title:'London Elections Night',
        source:'BBC',
        topic:'News',
        country:'GB',
        region:'Europe',
        lat:51.5072, lng:-0.1276,
        videoId:'GKB6HrLWL70'
      },
      {
        id:'5',
        title:'Paris Tech Week Highlights',
        source:'REUTERS',
        topic:'Tech',
        country:'FR',
        region:'Europe',
        lat:48.8566, lng:2.3522,
        videoId:'GKB6HrLWL70' // example: reuse or change if you want another video
      },

      // Asia
      {
        id:'6',
        title:'Tokyo Nightlife Pulse',
        source:'CNN',
        topic:'Culture',
        country:'JP',
        region:'Asia',
        lat:35.6895, lng:139.6917,
        videoId:'DBkz3q2PhF0'
      },
      {
        id:'7',
        title:'Seoul Esports Finals',
        source:'BBC',
        topic:'Sports',
        country:'KR',
        region:'Asia',
        lat:37.5665, lng:126.9780,
        videoId:'Ua7jtqqXGjY'
      },

      // Middle East
      {
        id:'8',
        title:'Tel Aviv Startup Pulse',
        source:'YNET',
        topic:'Tech',
        country:'IL',
        region:'Middle East',
        lat:32.0853, lng:34.7818,
        videoId:'YDewrrfN4NY'
      },
      {
        id:'9',
        title:'Dubai Lifestyle Trends',
        source:'REUTERS',
        topic:'Culture',
        country:'AE',
        region:'Middle East',
        lat:25.2048, lng:55.2708,
        videoId:'3C3lvtqjbwo'
      },
	   // AnyClip Live Events ‚Äì examples
	  {
		id: 'E1',
		title: 'AnyClip Live Summit 2024 ‚Äì Keynote Replay',
		source: 'ANYCLIP',
		topic: 'Live Event',
		country: 'US',
		region: 'Americas',
		lat: 40.7580, lng: -73.9855, // NYC-ish
		videoId: 'VjqKog3XwZ8',  // <-- put your real YT ID
		eventPhase: 'past'
	  },
	  {
		id: 'E2',
		title: 'AnyClip Live Product Demo ‚Äì Streaming Now',
		source: 'ANYCLIP',
		topic: 'Live Event',
		country: 'GB',
		region: 'Europe',
		lat: 51.5072, lng: -0.1276, // London
		videoId: 'VaeOaXHfc3M', // <-- put your real YT ID
		eventPhase: 'current'
	  },
	  {
		id: 'E3',
		title: 'AnyClip Future Launch ‚Äì Coming Soon',
		source: 'ANYCLIP',
		topic: 'Live Event',
		country: 'IL',
		region: 'Middle East',
		lat: 32.0853, lng: 34.7818, // Tel Aviv
		videoId: null,             // no video yet
		eventPhase: 'future'
	  }
    ];

    // --- State ---
    let markers = [];
    const state = {
      q: '',
      sources: new Set(),
      topics: new Set(),
      regions: new Set(),
	  livePhase: null   // 'past' | 'current' | 'future' | null
    };

    // --- Player elements ---
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    const playerPanel = $('#playerPanel');
    const playerTitle = $('#playerTitle');
    const playerMeta  = $('#playerMeta');
    const playerPlaceholder = $('#playerPlaceholder');
    const playerFrameWrap   = $('#playerFrameWrap');
    const ytFrame = $('#ytFrame');
    const playerClose = $('#playerClose');

    function escapeHtml(s='') {
      return s.replace(/[&<>"']/g, c => ({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#039;"
      }[c]));
    }

    function setCurrentVideo(v) {
	  if (!v) return;

	  // meta text includes live phase if present
	  const phaseLabel = v.eventPhase
		? ` ‚Ä¢ ${v.eventPhase.toUpperCase()} event`
		: '';
	  playerTitle.textContent = v.title;
	  playerMeta.textContent  = `${v.source} (Publisher) ‚Ä¢ ${v.topic} ‚Ä¢ ${v.region}${phaseLabel}`;

	  // Future event or no videoId ‚Äì show ‚Äúcoming soon‚Äù panel instead of player
	  if (v.eventPhase === 'future' || !v.videoId) {
		ytFrame.src = '';
		playerFrameWrap.style.display   = 'none';
		playerPlaceholder.style.display = 'flex';
		playerPlaceholder.textContent   =
		  'This is a planned AnyClip Live Event.\nStay tuned for more details.';
		return;
	  }

	  // Past / current events ‚Äì play YouTube
	  const embedUrl = `https://www.youtube.com/embed/${v.videoId}?autoplay=1&rel=0`;
	  ytFrame.src = embedUrl;
	  playerPlaceholder.style.display = 'none';
	  playerFrameWrap.style.display   = 'block';
	}


    playerClose.addEventListener('click', () => {
      ytFrame.src = '';
      playerFrameWrap.style.display = 'none';
      playerPlaceholder.style.display = 'flex';
      playerTitle.textContent = 'Select a point on the map';
      playerMeta.textContent  = 'No video playing';
    });

    // --- Markers render ---
    function renderMarkers(list) {
  // Clear old markers
  markers.forEach(m => map.removeLayer(m));
  markers = [];

  list.forEach(v => {
    // Choose icon for live events
    let markerIcon = null;
    if (v.eventPhase === 'past') {
      markerIcon = liveIcons.past;
    } else if (v.eventPhase === 'current') {
      markerIcon = liveIcons.current;
    } else if (v.eventPhase === 'future') {
      markerIcon = liveIcons.future;
    }

    // Tooltip line for live events
    let liveMessage = '';
    if (v.eventPhase === 'current') liveMessage = 'AnyClip Live Event ‚Äì Streaming now';
    if (v.eventPhase === 'past')    liveMessage = 'Replay available';
    if (v.eventPhase === 'future')  liveMessage = 'Upcoming ‚Äì details soon';

    const popupText = `
      <b>${escapeHtml(v.title)}</b><br/>
      <small>Publisher: ${escapeHtml(v.source)} ‚Ä¢ Topic: ${escapeHtml(v.topic)} ‚Ä¢ ${escapeHtml(v.region)}</small><br/>
      ${liveMessage ? `<span style="font-size:11px;color:#49ff9b;">${liveMessage}</span><br/>` : ''}
      <span style="font-size:11px;color:#9fb0c2;">Click to watch in the player</span>
    `;

    // Create marker ONCE
    const marker = markerIcon
      ? L.marker([v.lat, v.lng], { icon: markerIcon })
      : L.marker([v.lat, v.lng]);

    marker.addTo(map).bindPopup(popupText);

    marker.on('click', () => {
      setCurrentVideo(v);
    });

    markers.push(marker);
  });

  $('#count').textContent = `${list.length} result${list.length === 1 ? '' : 's'}`;
}


    function applyFilters() {
	  const q = state.q.trim().toLowerCase();
	  const hasSource   = state.sources.size > 0;
	  const hasTopic    = state.topics.size > 0;
	  const hasRegion   = state.regions.size > 0;
	  const hasLivePhase = !!state.livePhase;

	  const filtered = demoVideos.filter(v => {
		const matchesQ       = !q || v.title.toLowerCase().includes(q);
		const matchesSource  = !hasSource   || state.sources.has(v.source);
		const matchesTopic   = !hasTopic    || state.topics.has(v.topic);
		const matchesRegion  = !hasRegion   || state.regions.has(v.region);
		const matchesLive    = !hasLivePhase || v.eventPhase === state.livePhase;

		return matchesQ && matchesSource && matchesTopic && matchesRegion && matchesLive;
	  });

	  const af = [];
	  if (hasSource)   af.push([...state.sources].join(', '));
	  if (hasTopic)    af.push([...state.topics].join(', '));
	  if (hasRegion)   af.push([...state.regions].join(', '));
	  if (hasLivePhase) af.push(`Live: ${state.livePhase}`);

	  $('#activeFilters').textContent = af.length ? af.join(' ‚Ä¢ ') : 'No filters';

	  renderMarkers(filtered);
	}


    function wireChips(containerId, targetSet) {
      $$('#' + containerId + ' .chip').forEach(chip => {
        chip.addEventListener('click', () => {
          const val = chip.getAttribute('data-value');
          if (chip.classList.contains('active')) {
            chip.classList.remove('active');
            targetSet.delete(val);
          } else {
            chip.classList.add('active');
            targetSet.add(val);
          }
          applyFilters();
        });
      });
    }

    // --- UI wiring ---
    wireChips('sources', state.sources);
    wireChips('topics', state.topics);
    wireChips('regions', state.regions);
	
	// Live Events chips ‚Äì single selection (Past / Current / Future)
	const liveChips = $$('#liveEvents .chip');
	liveChips.forEach(chip => {
	  chip.addEventListener('click', () => {
		const val = chip.getAttribute('data-value');

		if (state.livePhase === val) {
		  // clicking the same one again clears the filter
		  state.livePhase = null;
		  chip.classList.remove('active');
		} else {
		  state.livePhase = val;
		  // make it single-select
		  liveChips.forEach(c => c.classList.remove('active'));
		  chip.classList.add('active');
		}

		applyFilters();
	  });
	});

    $('#search').addEventListener('input', (e) => {
      state.q = e.target.value || '';
      applyFilters();
    });

    $('#reset').addEventListener('click', () => {
      state.q = '';
      $('#search').value = '';
      state.sources.clear(); state.topics.clear(); state.regions.clear();
      $$('.chip.active').forEach(c => c.classList.remove('active'));
      applyFilters();
    });

    const panel = $('#filters');
    const toggle = $('#toggle');
    let collapsed = false;
    toggle.addEventListener('click', () => {
      collapsed = !collapsed;
      panel.classList.toggle('collapsed', collapsed);
      toggle.textContent = collapsed ? '‚ñ∏' : '‚ñæ';
    });

    // --- Make panels draggable ---
function makeDraggable(el, handle) {
  let isDown = false;
  let offsetX = 0;
  let offsetY = 0;

  handle.style.cursor = handle.style.cursor || 'move';

  handle.addEventListener('mousedown', (e) => {
    // Don't start dragging when interacting with form controls
    const t = e.target;
    const tag = t.tagName;
    if (
      tag === 'INPUT' ||
      tag === 'TEXTAREA' ||
      tag === 'BUTTON' ||
      tag === 'SELECT' ||
      t.isContentEditable
    ) {
      return; // let the input/button behave normally
    }

    e.preventDefault();
    isDown = true;

    const rect = el.getBoundingClientRect();
    offsetX = e.clientX - rect.left;
    offsetY = e.clientY - rect.top;

    // switch to left/top control (so right/bottom won't fight us)
    el.style.right = 'auto';
    el.style.bottom = 'auto';

    document.addEventListener('mousemove', onMouseMove);
    document.addEventListener('mouseup', onMouseUp);
  });

  function onMouseMove(e) {
    if (!isDown) return;
    el.style.left = (e.clientX - offsetX) + 'px';
    el.style.top  = (e.clientY - offsetY) + 'px';
  }

  function onMouseUp() {
    isDown = false;
    document.removeEventListener('mousemove', onMouseMove);
    document.removeEventListener('mouseup', onMouseUp);
  }
}


// apply draggable behavior
const filtersPanel = document.getElementById('filters');
const playerPanelEl = document.getElementById('playerPanel');
const playerHeaderEl = playerPanelEl.querySelector('.player-header');

// drag the filters by grabbing anywhere on the panel
makeDraggable(filtersPanel, filtersPanel);

// drag the player by grabbing the header bar
makeDraggable(playerPanelEl, playerHeaderEl);

    
    // Initial render
    applyFilters();
  </script>
</body>
</html>
